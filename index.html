<!DOCTYPE html>
<html lang='en'>
    
<head>

    <meta charset='utf-8' />
    <title>Meet the THB</title>
    <meta name='viewport' content='width=device-width, initial-scale=1' />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.css' rel='stylesheet' />

    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet"/>

<style>

            body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }

        .mapboxgl-popup {
            max-width: 200px;
        }

        .mapboxgl-popup-content {
            text-align: left;
            font-family: 'Open Sans', sans-serif;
        }
</style>
    
</head>
    
<body>
<style>
    #menu {
        background: #fff;
        position: absolute;
        z-index: 1;
        top: 10px;
        right: 10px;
        border-radius: 3px;
        width: 120px;
        border: 1px solid rgba(0, 0, 0, 0.4);
        font-family: 'Open Sans', sans-serif;
    }

    #menu a {
        font-size: 13px;
        color: #404040;
        display: block;
        margin: 0;
        padding: 0;
        padding: 10px;
        text-decoration: none;
        border-bottom: 1px solid rgba(0, 0, 0, 0.25);
        text-align: center;
    }

    #menu a:last-child {
        border: none;
    }

    #menu a:hover {
        background-color: #f8f8f8;
        color: #404040;
    }

    #menu a.active {
        background-color: #76AEB7;
        color: #ffffff;
    }

    #menu a.active:hover {
        background: #487981;
    }
    
    #welcomeWrapper {
          text-align: center;
          position: fixed;
          top: 60%;
          left: 50%;
          transform: translate(-50%,-100%);
          width: 45%;
          z-index: 700;
          font-family: 'Open Sans', sans-serif;
          font-size: 14px;
          color: black;
          background-color: rgba(239, 239, 239, 1);
          box-shadow: 0 1px 5px black;
          padding: 10px;
          border-radius: 25px;
    }
</style>

<div id="welcomeWrapper">
    <h1>Meet the Travelers' Health Branch</h1> 

    <p>The four different layers in this map relate to the four different questions asked in the survey: Where are you from? Where did you go to school? What is your favorite place you've ever lived? And where would you most like to travel internationally after the pandemic?</p>
    
    <p>You can toggle these layers on and off using the menu in the upper right-hand corner. You may need to double click to turn a layer off the first time, and it may take a moment for the map layers to render after being switched on or off. And don't forget to zoom in, some places, like Atlanta, have quite a few points!</p>
    
    <p class="click"><strong>Click anywhere on the map to start</strong></p>
</div>
<nav id="menu"></nav>
<div id="map"></div>


<script>
    $(document).click(function(){
        $("#welcomeWrapper").hide();
    });
    
	mapboxgl.accessToken = 'pk.eyJ1IjoiZWxsaWVtYXBzIiwiYSI6ImNrbXNodDk1NDBodXQyd281cTNmaGkyZmQifQ.CgVgTN5Coqtw2SpQnrCm2Q';
    
    var bounds = [
        [-130,-60], // Southwest coordinates
        [180,70] // Northeast coordinates
    ];
        
    var map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/elliemaps/ckngscr5x0ea417mkooe9tywu',
      center: [31.142344, 26.371925],
        zoom: 1.3,
      minZoom: 1,
        maxZoom: 10,
        maxBounds: bounds
    });
    
    var nav = new mapboxgl.NavigationControl();
    map.addControl(nav, 'top-left');
        
    //disable map rotation using right click + drag
    map.dragRotate.disable();

    //disable map rotation using touch rotation gesture
    map.touchZoomRotate.disableRotation();

    // Wait until the map has finished loading.
    map.on('load', function () {
        
        map.on('click', function(e) {

            var features = map.queryRenderedFeatures(e.point, {
                layers: ['From', 'School', 'Favorite', 'Travel'] // Mapbox Studio dataset layers
            });

              if (!features.length) {
                return;
              }

            var places = features[0];

            var popup = new mapboxgl.Popup({ offset: [0, -15] })
                .setLngLat(places.geometry.coordinates)
                .setHTML('<h3>' + places.properties.name + ', ' + places.properties.job + '</h3><h4>' + places.properties.question + '</h4>' + places.properties.comments + '</p>')
                .addTo(map);
        });
        
        
        //change the cursor to a pointer when the mouse is over the places layer.
        map.on('mouseenter', 'thb', function() {
            map.getCanvas().style.cursor = 'pointer';
        });

        //change back to pointer
        map.on('mouseleave', 'thb', function() {
            map.getCanvas().style.cursor = '';
        });

    });

    var toggleableLayerIds = ['From', 'School', 'Favorite', 'Travel'];

    for (var i = 0; i < toggleableLayerIds.length; i++) {
      var id = toggleableLayerIds[i];

      var link = document.createElement('a');
      link.href = '#';
      link.className = 'active';
      link.textContent = id;

      link.onclick = function(e) {
        var clickedLayer = this.textContent;
        e.preventDefault();
        e.stopPropagation();

        var visibility = map.getLayoutProperty(clickedLayer, 'visibility');

        if (visibility === 'visible') {
          map.setLayoutProperty(clickedLayer, 'visibility', 'none');
          this.className = '';
        } else {
          this.className = 'active';
          map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
        }
      };

      var layers = document.getElementById('menu');
      layers.appendChild(link);
    }

</script>

</body>
</html>